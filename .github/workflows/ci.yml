name: CI

on:
    pull_request_target:

concurrency:
    group: "${{ github.actor }} - ${{github.ref}} - ci"
    cancel-in-progress: true

jobs:
    validate:
        uses: ./.github/workflows/validate.yml
    lint:
        uses: ./.github/workflows/lint.yml
    check:
        uses: ./.github/workflows/check.yml

    hemtt:
        name: Build with HEMTT
        permissions: write-all
        runs-on: windows-latest
        needs: [validate, lint, check]
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - uses: ./.github/workflows/base
            - name: Setup HEMTT
              uses: arma-actions/hemtt@v1
            - name: Run HEMTT build
              run: hemtt build
            - name: Rename build folder
              run: mv .hemttout/build .hemttout/@rtf42
            - name: Upload Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: rtf42-${{ github.sha }}
                  path: .hemttout/@*
